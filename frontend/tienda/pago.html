<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="../assets/img/favicon.ico" type="image/x-icon">
  <title>Finalizar Compra - KICKS</title>
  
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <!-- Estilos -->
  <link rel="stylesheet" href="../css/globals.css">
  <link rel="stylesheet" href="../css/pago.css">
  
  <!-- Script para aplicar tema antes del render -->
  <script>
    (function() {
      const storedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const theme = storedTheme || (prefersDark ? "dark" : "light");
      document.documentElement.setAttribute("data-theme", theme);
    })();
  </script>
</head>
<body>
  <div class="checkout-page">
    <div class="container">
      <!-- Header -->
      <div class="checkout-header">
        <h1 class="checkout-title">Finalizar Compra</h1>
        <p class="checkout-subtitle">Completa tu informaci√≥n de env√≠o y pago</p>
      </div>

      <!-- Contenido Principal -->
      <div class="checkout-content">
        <!-- Formulario de Checkout -->
        <div class="checkout-form-section">
          <form id="checkout-form">
            <!-- Informaci√≥n de Env√≠o -->
            <div class="form-section">
              <h2 class="section-title">Informaci√≥n de Env√≠o</h2>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="nombre_envio">Nombre completo</label>
                  <input type="text" id="nombre_envio" name="nombre_envio" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="telefono">Tel√©fono</label>
                  <input type="tel" id="telefono" name="telefono" required>
                </div>
                
                <div class="form-group">
                  <label for="pais">Pa√≠s</label>
                  <select id="pais" name="pais" required>
                    <option value="">Selecciona un pa√≠s</option>
                    <!-- Se llenar√°n din√°micamente -->
                  </select>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="direccion_envio">Direcci√≥n</label>
                  <input type="text" id="direccion_envio" name="direccion_envio" required>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="ciudad">Ciudad</label>
                  <input type="text" id="ciudad" name="ciudad" required>
                </div>
                
                <div class="form-group">
                  <label for="codigo_postal">C√≥digo Postal</label>
                  <input type="text" id="codigo_postal" name="codigo_postal" required>
                </div>
              </div>
            </div>

            <!-- M√©todo de Pago -->
            <div class="form-section">
              <h2 class="section-title">M√©todo de Pago</h2>
              
              <div class="payment-methods">
                <div class="payment-option">
                  <input type="radio" id="tarjeta" name="metodo_pago" value="tarjeta" checked>
                  <label for="tarjeta">
                    <span class="payment-icon">üí≥</span>
                    <span>Tarjeta de Cr√©dito/D√©bito</span>
                  </label>
                </div>
                
                <div class="payment-option">
                  <input type="radio" id="oxxo" name="metodo_pago" value="oxxo">
                  <label for="oxxo">
                    <span class="payment-icon">üè™</span>
                    <span>OXXO</span>
                  </label>
                </div>
                
                <div class="payment-option">
                  <input type="radio" id="transferencia" name="metodo_pago" value="transferencia">
                  <label for="transferencia">
                    <span class="payment-icon">üè¶</span>
                    <span>Transferencia Bancaria</span>
                  </label>
                </div>
              </div>

              <!-- Formulario de Tarjeta -->
              <div id="card-form" class="payment-form active">
                <div class="form-row">
                  <div class="form-group">
                    <label for="card_number">N√∫mero de tarjeta</label>
                    <input type="text" id="card_number" maxlength="19" placeholder="1234 5678 9012 3456">
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="card_name">Nombre en la tarjeta</label>
                    <input type="text" id="card_name" placeholder="Como aparece en la tarjeta">
                  </div>
                </div>

                <div class="form-row">
                  <div class="form-group">
                    <label for="card_expiry">Fecha de expiraci√≥n</label>
                    <input type="text" id="card_expiry" maxlength="5" placeholder="MM/AA">
                  </div>
                  
                  <div class="form-group">
                    <label for="card_cvv">CVV</label>
                    <input type="text" id="card_cvv" maxlength="4" placeholder="123">
                  </div>
                </div>
              </div>

              <!-- Informaci√≥n OXXO -->
              <div id="oxxo-info" class="payment-form">
                <div class="payment-info-box">
                  <p>Recibir√°s una referencia de pago para realizar el pago en cualquier tienda OXXO.</p>
                  <p>El pago puede tardar hasta 24 horas en reflejarse.</p>
                </div>
              </div>

              <!-- Informaci√≥n Transferencia -->
              <div id="transfer-info" class="payment-form">
                <div class="payment-info-box">
                  <p>Recibir√°s los datos bancarios para realizar la transferencia.</p>
                  <p>El pago puede tardar hasta 48 horas en reflejarse.</p>
                </div>
              </div>
            </div>

            <!-- Cup√≥n de Descuento -->
            <div class="form-section">
              <h2 class="section-title">Cup√≥n de Descuento (Opcional)</h2>
              <div class="form-row">
                <div class="form-group" style="flex: 1;">
                  <input type="text" id="cupon" name="cupon" placeholder="Ingresa tu c√≥digo">
                  <p id="cupon-mensaje" style="margin-top: 8px; font-size: 0.9rem; font-weight: 500; min-height: 20px;"></p>
                </div>
                <button type="button" id="btn-validar-cupon" class="btn" style="height: fit-content; padding: 12px 24px; margin-top: 0;">
                  Aplicar
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Resumen de Orden -->
        <div class="order-summary">
          <h2 class="summary-title">Resumen de tu pedido</h2>
          
          <div id="order-items" class="order-items">
            <!-- Se llenar√° din√°micamente -->
          </div>

          <div class="summary-details">
            <div class="summary-row">
              <span>Subtotal</span>
              <span id="subtotal">$0.00</span>
            </div>
            <div class="summary-row">
              <span>Env√≠o</span>
              <span id="envio">$0.00</span>
            </div>
            <div class="summary-row">
              <span>Impuestos</span>
              <span id="impuestos">$0.00</span>
            </div>
            <div class="summary-row total">
              <span>Total</span>
              <span id="total">$0.00</span>
            </div>
          </div>

          <button type="button" id="btn-confirmar-pago" class="btn-primary-full">
            Confirmar Pedido
          </button>

          <div class="secure-payment">
            <p>Pago 100% seguro</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script type="module">
    import { ThemeBtn } from '../components/theme-btn.js';
    import { Header } from '../components/header.js';
    import { Footer } from '../components/footer.js';
  
    ThemeBtn();
  
    const header = await Header();
    const footer = Footer();
    
    document.body.insertBefore(header, document.body.firstChild);
    document.body.appendChild(footer);
  </script>
  <script type="module" src="../js/pago.js"></script>
</body>
</html>